package Automation;

import org.openqa.selenium.By;
import org.testng.Assert;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;


public class LoginTests extends BaseTest {

    private  final String WrongPassAlert = "Wrong password.";
    private  final String UserDoesNotExistAlert = "User does not exist.";
    private  final String FillRequiredAlert = "Please fill out Username and Password.";

    private final String noUSer = "noUSerHEeeeeeeeeeeeere";
    private final String wrongPassTest = "noUSerHEeeeeeeeeeeeere";
    


  
    @BeforeClass
    public void createTestUser() {
        driver.get(BASE_URL);
        authPage.clickSignupLink();
        authPage.performSignup(testUsername, ValidPassword);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, "Sign up successful.");
    }

    
    @Test(priority = 1, description = "TC014: Verify Successful Login",enabled = true)
    public void tc014_SuccessfulLogin() {
        authPage.clickLoginLink();
        authPage.performLogin(testUsername, ValidPassword);
        String WelcomeMessage = "Welcome " + testUsername;
        Assert.assertEquals(authPage.getWelcomeMessage(), WelcomeMessage);
        authPage.clickLogout();
    }

    @Test(priority = 2, description = "TC015:Verify Login with Invalid password",enabled = true)
    public void tc015_InvalidPassword() {
        authPage.clickLoginLink();
        authPage.performLogin(testUsername, WrongPassAlert);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, WrongPassAlert);
        driver.navigate().refresh();

      
    }

    @Test(priority = 3, description = "TC016:Verify Login with Invalid password",enabled = true)
    public void tc016_NonExistingUser() {
        authPage.clickLoginLink();
        authPage.performLogin(noUSer, ValidPassword);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, UserDoesNotExistAlert);
        driver.navigate().refresh();

    }
    
    

    @Test(priority = 4, description = "TC017:Verify Login with Invalid password",enabled = true)
    public void tc017_BlankFields() {
        authPage.clickLoginLink();
        authPage.performLogin("", "");
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, FillRequiredAlert);
        driver.navigate().refresh();

    }

    
    
    @Test(priority = 5, description = "TC018:Verify Password Case-Sensitivity",enabled = true)
    public void tc018_CaseSensitivity() {
       
        authPage.clickLoginLink();
        String LowerCasePass = ValidPassword.toLowerCase();
        authPage.performLogin(testUsername, LowerCasePass);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, WrongPassAlert);
        driver.navigate().refresh();

    }
    
    
    
    @Test(priority = 6, description = "TC019:Verify Login with leading/trailing spaces in fields",enabled = true)
    public void tc019_LeadingTrailingSpaces() {
        String SpacedUsername = "  " + testUsername + "  ";
        authPage.clickLoginLink();
        authPage.performLogin(SpacedUsername, ValidPassword);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, UserDoesNotExistAlert);     
        driver.navigate().refresh();

    }
    
    
    
    @Test(priority = 10, description = "Verify Login attempts lock-out ",enabled = true)
    public void tc020_AccountLockout() {
      
        
        authPage.clickLoginLink();
        
        for (int NumberOfAttempts = 1; NumberOfAttempts <= 5; NumberOfAttempts++) {
            authPage.performLogin(testUsername, wrongPassTest);
            String alertText = authPage.handleAlertAndGetText();
            Assert.assertEquals(alertText, WrongPassAlert);
            if (NumberOfAttempts < 5) authPage.clickLoginLink();
        }

        authPage.clickLoginLink();  
        authPage.performLogin(testUsername, ValidPassword);
        String alertText = authPage.handleAlertAndGetText();
        Assert.assertEquals(alertText, "Your account Locked ");
        
        driver.navigate().refresh();


        
    }
    
    
    
    
    @Test(priority = 7, description = "TC021:Verify cannot access logged-in features after logout",enabled = true)
    public void tc021_SessionTerminationOnLogout() {
        authPage.clickLoginLink();
        authPage.performLogin(testUsername, ValidPassword);
        authPage.getWelcomeMessage(); 
        authPage.clickLogout();

        Assert.assertFalse(authPage.isUserLoggedIn());
        driver.navigate().refresh();

    }
    
    
    @Test(priority = 9, description = "TC022:Verify multiple login/logout cycles",enabled = true )
    public void tc022_MultipleCycles() {
        final int CYCLES = 2;
        
        for (int Attempts = 1; Attempts <= CYCLES; Attempts++) {
            // 1. Login
            driver.findElement(By.id("login2")).click();
            authPage.performLogin(testUsername, ValidPassword);
            Assert.assertFalse(authPage.isUserLoggedIn());

            driver.findElement(By.id("logout2")).click();
            Assert.assertFalse(authPage.isUserLoggedIn());

            
            System.out.println("TC022 Cycle " + Attempts + " completed successfully.");
        }
        driver.navigate().refresh();


    }
    
    @Test(priority = 8, description = "TC023:Verify Password Masking",enabled = true)
    public void tc023_MaskingPassword() {
        authPage.clickLoginLink(); 
        
        String actualType = driver.findElement(By.id("loginpassword")).getAttribute("type");
        String expectedType = "password";
        
        Assert.assertEquals(actualType, expectedType);
        
    
        By loginCloseButton = By.xpath("//*[@id=\"logInModal\"]/div/div/div[3]/button[1]");
        driver.findElement(loginCloseButton).click();
        driver.navigate().refresh();

    
    }
}
